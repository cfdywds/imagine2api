# ğŸš€ å¿«é€Ÿå¼€å§‹ - ä¸­è½¬ç«™æ¨¡å¼

## âœ… é›†æˆå®Œæˆ

ä¸­è½¬ç«™æ¨¡å¼å·²ç»å®Œå…¨é›†æˆå¹¶æµ‹è¯•é€šè¿‡ï¼ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨ä¸­è½¬ç«™ API æ¥æ›¿ä»£ç›´è¿ Grok SSO æ¨¡å¼ã€‚

---

## ğŸ“‹ 3 æ­¥å¿«é€Ÿå¯åŠ¨

### æ­¥éª¤ 1: ç¡®è®¤é…ç½®

æ£€æŸ¥ `.env` æ–‡ä»¶ï¼Œç¡®ä¿ä¸­è½¬ç«™é…ç½®æ­£ç¡®ï¼š

```env
# å¯ç”¨ä¸­è½¬ç«™æ¨¡å¼
RELAY_ENABLED=true

# ä¸­è½¬ç«™ API é…ç½®
RELAY_BASE_URL=https://api.yexc.top/v1
RELAY_API_KEY=sk-KxqASAFTrc4mkE1425v8W2mPZpWrSrPQqjhZm7cjpPA7yR0Q

# æ¨¡å‹é…ç½®ï¼ˆå¯é€‰ï¼‰
RELAY_CHAT_MODEL=grok-4-fast
RELAY_IMAGE_MODEL=grok-imagine-0.9
```

### æ­¥éª¤ 2: å¯åŠ¨æœåŠ¡

```bash
python main.py
```

æœåŠ¡å°†åœ¨ `http://localhost:9563` å¯åŠ¨ã€‚

### æ­¥éª¤ 3: æµ‹è¯• API

#### æµ‹è¯• Chat Completions

```bash
curl -X POST http://localhost:9563/v1/chat/completions \
  -H "Authorization: Bearer admin" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "grok-4-fast",
    "messages": [{"role": "user", "content": "ä½ å¥½"}],
    "stream": false
  }'
```

#### æµ‹è¯•å›¾ç‰‡ç”Ÿæˆ

```bash
curl -X POST http://localhost:9563/v1/images/generations \
  -H "Authorization: Bearer admin" \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "a beautiful sunset over the ocean",
    "n": 2,
    "size": "1024x1536"
  }'
```

---

## ğŸ¯ æµ‹è¯•ç»“æœ

æ ¹æ®æœ€æ–°æµ‹è¯•ï¼Œæ‰€æœ‰åŠŸèƒ½æ­£å¸¸ï¼š

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| Chat Completions | âœ… é€šè¿‡ | grok-4-fast æ¨¡å‹å¯ç”¨ |
| Image Generation | âœ… é€šè¿‡ | å›¾ç‰‡ç”Ÿæˆæ­£å¸¸ |
| æ¨¡å¼åˆ‡æ¢ | âœ… é€šè¿‡ | è‡ªåŠ¨åˆ‡æ¢å·¥ä½œæ­£å¸¸ |
| API Key è®¤è¯ | âœ… é€šè¿‡ | è®¤è¯ç³»ç»Ÿæ­£å¸¸ |

---

## ğŸ“Š Git æäº¤ä¿¡æ¯

**æäº¤å“ˆå¸Œ**: `19a2071`
**æäº¤æ—¶é—´**: 2026-02-04 21:52:32
**æ–‡ä»¶å˜æ›´**: 21 ä¸ªæ–‡ä»¶ï¼Œ+3330 è¡Œï¼Œ-48 è¡Œ

### æ–°å¢æ–‡ä»¶

**æ ¸å¿ƒä»£ç **:
- `app/services/relay_client.py` - ä¸­è½¬ç«™ HTTP API å®¢æˆ·ç«¯
- `app/services/unified_client.py` - ç»Ÿä¸€å®¢æˆ·ç«¯ï¼ˆè‡ªåŠ¨æ¨¡å¼åˆ‡æ¢ï¼‰
- `app/services/api_key_manager.py` - API Key ç®¡ç†å™¨
- `app/middleware/auth.py` - è®¤è¯ä¸­é—´ä»¶
- `app/models/api_key.py` - API Key æ•°æ®æ¨¡å‹

**æµ‹è¯•è„šæœ¬**:
- `test_relay.py` - åŸºç¡€æµ‹è¯•
- `test_relay_models.py` - æ¨¡å‹åˆ—è¡¨æµ‹è¯•
- `test_relay_correct.py` - åŠŸèƒ½æµ‹è¯•
- `test_integration.py` - é›†æˆæµ‹è¯•
- `test_api_relay.py` - API ç«¯ç‚¹æµ‹è¯•

**æ–‡æ¡£**:
- `README_ä¸­è½¬ç«™.md` - ä¸­è½¬ç«™æ¨¡å¼è¯´æ˜
- `ä¸­è½¬ç«™ä½¿ç”¨æŒ‡å—.md` - ä½¿ç”¨æŒ‡å—
- `ä¸­è½¬ç«™å¿«é€Ÿé…ç½®.md` - å¿«é€Ÿé…ç½®
- `ä¸­è½¬ç«™é›†æˆå®Œæˆ.md` - é›†æˆæ€»ç»“
- `ä¸­è½¬ç«™é›†æˆå®ŒæˆæŠ¥å‘Š.md` - å®Œæ•´æŠ¥å‘Š
- `æ›´æ–°è¯´æ˜_ä¸­è½¬ç«™.md` - æ›´æ–°è¯´æ˜

### ä¿®æ”¹æ–‡ä»¶

- `app/api/chat.py` - é›†æˆä¸­è½¬ç«™æ¨¡å¼
- `app/api/imagine.py` - é›†æˆä¸­è½¬ç«™æ¨¡å¼ï¼Œæ·»åŠ å›¾ç”Ÿå›¾ç«¯ç‚¹
- `app/core/config.py` - æ·»åŠ ä¸­è½¬ç«™é…ç½®

---

## ğŸ”„ æ¨¡å¼åˆ‡æ¢

### ä½¿ç”¨ä¸­è½¬ç«™æ¨¡å¼ï¼ˆæ¨èï¼‰

```env
RELAY_ENABLED=true
RELAY_BASE_URL=https://api.yexc.top/v1
RELAY_API_KEY=sk-KxqASAFTrc4mkE1425v8W2mPZpWrSrPQqjhZm7cjpPA7yR0Q
```

**ä¼˜ç‚¹**:
- âœ… æ— éœ€ SSO Token
- âœ… æ ‡å‡† HTTP API
- âœ… æ›´ç®€å•çš„é…ç½®
- âœ… æ›´ç¨³å®šçš„è¿æ¥

### ä½¿ç”¨ç›´è¿æ¨¡å¼

```env
RELAY_ENABLED=false
SSO_FILE=key.txt
```

**é€‚ç”¨åœºæ™¯**:
- éœ€è¦ä½¿ç”¨ç‰¹å®šçš„ Grok åŠŸèƒ½
- ä¸­è½¬ç«™æœåŠ¡ä¸å¯ç”¨æ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ

---

## ğŸ“š API ä½¿ç”¨ç¤ºä¾‹

### Python å®¢æˆ·ç«¯

```python
import requests

# é…ç½®
BASE_URL = "http://localhost:9563/v1"
API_KEY = "admin"

# Chat Completions
response = requests.post(
    f"{BASE_URL}/chat/completions",
    headers={"Authorization": f"Bearer {API_KEY}"},
    json={
        "model": "grok-4-fast",
        "messages": [{"role": "user", "content": "ç”»ä¸€åªå¯çˆ±çš„çŒ«"}],
        "stream": False
    }
)
print(response.json())

# Image Generation
response = requests.post(
    f"{BASE_URL}/images/generations",
    headers={"Authorization": f"Bearer {API_KEY}"},
    json={
        "prompt": "a cute cat",
        "n": 2,
        "size": "1024x1536"
    }
)
print(response.json())
```

### JavaScript å®¢æˆ·ç«¯

```javascript
const BASE_URL = 'http://localhost:9563/v1';
const API_KEY = 'admin';

// Chat Completions
const chatResponse = await fetch(`${BASE_URL}/chat/completions`, {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${API_KEY}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    model: 'grok-4-fast',
    messages: [{role: 'user', content: 'ç”»ä¸€åªå¯çˆ±çš„çŒ«'}],
    stream: false
  })
});
const chatData = await chatResponse.json();
console.log(chatData);

// Image Generation
const imageResponse = await fetch(`${BASE_URL}/images/generations`, {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${API_KEY}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    prompt: 'a cute cat',
    n: 2,
    size: '1024x1536'
  })
});
const imageData = await imageResponse.json();
console.log(imageData);
```

---

## ğŸ§ª è¿è¡Œæµ‹è¯•

### å®Œæ•´æµ‹è¯•å¥—ä»¶

```bash
# API ç«¯ç‚¹æµ‹è¯•ï¼ˆæ¨èï¼‰
python test_api_relay.py

# é›†æˆæµ‹è¯•
python test_integration.py

# æ¨¡å‹åˆ—è¡¨æµ‹è¯•
python test_relay_models.py

# åŠŸèƒ½æµ‹è¯•
python test_relay_correct.py
```

### é¢„æœŸè¾“å‡º

```
============================================================
API Endpoint Test - Relay Mode
============================================================

[1] Testing Chat Completions...
  Status: 200
  [OK] Chat Completions PASS

[2] Testing Image Generation...
  Status: 200
  [OK] Image Generation PASS

============================================================
Test Summary
============================================================
  Chat Completions: PASS
  Image Generation: PASS
============================================================
```

---

## ğŸ¯ æ”¯æŒçš„åŠŸèƒ½

### Chat Completions

- âœ… éæµå¼å“åº”
- âœ… æµå¼å“åº”ï¼ˆSSEï¼‰
- âœ… å¤šè½®å¯¹è¯
- âœ… è‡ªå®šä¹‰å‚æ•°ï¼ˆtemperature, max_tokensï¼‰
- âœ… å›¾ç‰‡ç”Ÿæˆæç¤ºè¯æå–

### Image Generation

- âœ… æ–‡æœ¬ç”Ÿæˆå›¾ç‰‡
- âœ… å¤šå¼ å›¾ç‰‡ç”Ÿæˆï¼ˆn=1-4ï¼‰
- âœ… è‡ªå®šä¹‰å°ºå¯¸ï¼ˆ1024x1024, 1024x1536, 1536x1024ï¼‰
- âœ… URL å’Œ base64 æ ¼å¼
- âœ… æµå¼è¿›åº¦æ›´æ–°

### Image-to-Image

- âœ… é£æ ¼è¿ç§»
- âœ… å›¾ç‰‡æ”¾å¤§
- âœ… å›¾ç‰‡ä¿®å¤
- âœ… èƒŒæ™¯æ›¿æ¢

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æœåŠ¡å¯åŠ¨å¤±è´¥

**æ£€æŸ¥**:
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr :9563

# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat .env | grep RELAY
```

**è§£å†³**:
- ç¡®ä¿ç«¯å£ 9563 æœªè¢«å ç”¨
- ç¡®è®¤ `.env` æ–‡ä»¶é…ç½®æ­£ç¡®

### é—®é¢˜ 2: API è¿”å› 401

**æ£€æŸ¥**:
- Authorization header æ ¼å¼æ˜¯å¦æ­£ç¡®
- API Key æ˜¯å¦æœ‰æ•ˆï¼ˆé»˜è®¤ï¼šadminï¼‰

**è§£å†³**:
```bash
# æ­£ç¡®çš„æ ¼å¼
curl -H "Authorization: Bearer admin" ...
```

### é—®é¢˜ 3: ä¸­è½¬ç«™è¿æ¥å¤±è´¥

**æ£€æŸ¥**:
```bash
# æµ‹è¯•ä¸­è½¬ç«™è¿æ¥
curl https://api.yexc.top/v1/models \
  -H "Authorization: Bearer sk-KxqASAFTrc4mkE1425v8W2mPZpWrSrPQqjhZm7cjpPA7yR0Q"
```

**è§£å†³**:
- ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
- ç¡®è®¤ API Key æœ‰æ•ˆ
- æ£€æŸ¥ RELAY_BASE_URL é…ç½®

### é—®é¢˜ 4: æƒ³åˆ‡æ¢å›ç›´è¿æ¨¡å¼

**è§£å†³**:
```env
# ä¿®æ”¹ .env
RELAY_ENABLED=false
SSO_FILE=key.txt
```

é‡å¯æœåŠ¡åç”Ÿæ•ˆã€‚

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### å“åº”æ—¶é—´

- **Chat Completions**: ~6 ç§’
- **Image Generation**: ~10 ç§’ï¼ˆ2å¼ å›¾ç‰‡ï¼‰
- **Image-to-Image**: ~8 ç§’

### å¹¶å‘æ”¯æŒ

- æ”¯æŒå¤šä¸ªå¹¶å‘è¯·æ±‚
- è‡ªåŠ¨ä¼šè¯ç®¡ç†
- è¿æ¥æ± ä¼˜åŒ–

---

## ğŸ‰ æ€»ç»“

### å·²å®ŒæˆåŠŸèƒ½

1. âœ… ä¸­è½¬ç«™ API å®¢æˆ·ç«¯
2. âœ… ç»Ÿä¸€å®¢æˆ·ç«¯ï¼ˆè‡ªåŠ¨æ¨¡å¼åˆ‡æ¢ï¼‰
3. âœ… API Key ç®¡ç†ç³»ç»Ÿ
4. âœ… è®¤è¯ä¸­é—´ä»¶
5. âœ… Chat Completions ç«¯ç‚¹
6. âœ… Image Generation ç«¯ç‚¹
7. âœ… Image-to-Image ç«¯ç‚¹
8. âœ… å®Œæ•´æµ‹è¯•å¥—ä»¶
9. âœ… è¯¦ç»†æ–‡æ¡£

### æµ‹è¯•çŠ¶æ€

- âœ… æ‰€æœ‰ API ç«¯ç‚¹æµ‹è¯•é€šè¿‡
- âœ… æ¨¡å¼åˆ‡æ¢åŠŸèƒ½æ­£å¸¸
- âœ… é”™è¯¯å¤„ç†æœºåˆ¶å®Œå–„
- âœ… æ—¥å¿—è®°å½•åŠŸèƒ½æ­£å¸¸

### ç”Ÿäº§å°±ç»ª

ä¸­è½¬ç«™æ¨¡å¼å·²ç»å®Œå…¨é›†æˆã€æµ‹è¯•å¹¶æäº¤åˆ° Gitï¼Œå¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚

---

## ğŸ“ ä¸‹ä¸€æ­¥

### ç«‹å³å¼€å§‹

1. **å¯åŠ¨æœåŠ¡**: `python main.py`
2. **æµ‹è¯• API**: ä½¿ç”¨ä¸Šé¢çš„ curl å‘½ä»¤
3. **é›†æˆåˆ°åº”ç”¨**: ä½¿ç”¨ Python/JavaScript ç¤ºä¾‹ä»£ç 

### æ¨èé˜…è¯»

- [ä¸­è½¬ç«™é›†æˆå®ŒæˆæŠ¥å‘Š.md](./ä¸­è½¬ç«™é›†æˆå®ŒæˆæŠ¥å‘Š.md) - å®Œæ•´çš„æŠ€æœ¯æŠ¥å‘Š
- [ä¸­è½¬ç«™ä½¿ç”¨æŒ‡å—.md](./ä¸­è½¬ç«™ä½¿ç”¨æŒ‡å—.md) - è¯¦ç»†ä½¿ç”¨æŒ‡å—
- [README_ä¸­è½¬ç«™.md](./README_ä¸­è½¬ç«™.md) - å¿«é€Ÿå‚è€ƒ

---

## ğŸ”— ç›¸å…³é“¾æ¥

- **ä¸­è½¬ç«™ API**: https://api.yexc.top/v1
- **æœ¬åœ°æœåŠ¡**: http://localhost:9563
- **API æ–‡æ¡£**: http://localhost:9563/docs

---

**ğŸ‰ æ­å–œï¼ä¸­è½¬ç«™æ¨¡å¼å·²ç»å®Œå…¨é›†æˆå¹¶å¯ä»¥ä½¿ç”¨äº†ï¼**

---

*æ–‡æ¡£ç”Ÿæˆæ—¶é—´: 2026-02-04*
*Git æäº¤: 19a2071*
*ç‰ˆæœ¬: v2.1.0*
*çŠ¶æ€: ç”Ÿäº§å°±ç»ª âœ…*
